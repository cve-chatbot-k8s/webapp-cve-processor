# webapp


# This is a go application which downloads cve records and stores them in a postgres database.
To run this Application use the folowing command : 

```
make run
```

The Application Contains 2 Dockerfiles one for building the webapp and the other for building the flyway image.
The flyway image contains the DB migrations and is used as an init container to run the migrations before the application starts.




```
docker run -e DB_DATABASE=your_database -e DB_PASSWORD=your_password -e DB_USERNAME=your_username -e DB_PORT=your_port -e DB_HOST=your_host your_image

```

To build the flyway image locally use the following commands:

you need to specify the --network="host" to connect with postgres db which is running locally
```
docker build -t my-flyway-image -f Dockerfile.flyway .
docker run --network="host" --env-file .env $Image_Name
```


# Flyway is used to manage the database schema. The schema is stored in the resources/db/migration folder. The schema is versioned and flyway will apply the schema to the database when the application starts.

```
Create a flyway.conf file in the resources folder with the following content:
flyway.url=jdbc:postgresql://dbhost:port/dbname
flyway.user=username
flyway.password=password
flyway.locations=filesystem:./migration
```


The application uses concurrency to efficiently download the cve records.
 The size of buffered channel currently is set to 100.
 The goroutines will download the cve records and store them in the postgres db


## command to run the flyway migration: 

```
docker run --network="host" -it my-flyway-image migrate -X
```