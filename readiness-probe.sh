#!/bin/sh
 
KAFKA_CLUSTER="${KAFKA_BOOTSTRAP_SERVERS}"
TOPIC="${KAFKA_TOPIC}"
 
 
# Check if Kafka topic exists and if Kafka cluster is reachable
if kafkacat -L -b $KAFKA_CLUSTER | grep -q $TOPIC && echo $KAFKA_CLUSTER | tr "," "\n" | while read -r broker; do nc -zv $(echo $broker | awk -F: '{print $1}') $(echo $broker | awk -F: '{print $2}'); done; then
  exit 0
else
  exit 1
fi
